<%- include('partials/head') %>

  <!-- Main Content Area -->
  <div class="content-wrapper">
    <!-- Toolbar Section -->
    <div class="toolbar-section">
      <div class="toolbar-left">
        <h4 class="toolbar-title">
          <i class="fas fa-th-large"></i>
          Product Catalog
        </h4>
      </div>
      <div class="toolbar-right">
        <button id="btn-add" class="btn btn-add-product">
          <i class="fas fa-plus-circle"></i>
          <span>Add New Product</span>
        </button>
      </div>
    </div>

    <!-- Table Section -->
    <div class="table-section">
      <!-- Desktop Table View -->
      <div class="table-responsive desktop-view">
        <table class="table table-custom">
          <thead>
            <tr>
              <th style="width:90px">
                <i class="fas fa-image"></i> Photo
              </th>
              <th style="width:25%">
                <i class="fas fa-tag"></i> Product Name
              </th>
              <th style="width:120px">
                <i class="fas fa-dollar-sign"></i> Price
              </th>
              <th style="width:120px">
                <i class="fas fa-palette"></i> Color
              </th>
              <th style="width:35%">
                <i class="fas fa-align-left"></i> Description
              </th>
              <th style="width:140px" class="text-center">
                <i class="fas fa-cog"></i> Actions
              </th>
            </tr>
          </thead>
          <tbody id="product-table">
            <% products.forEach(function(p){ %>
              <tr data-id="<%= p.id %>" 
                  data-image="<%= p.imageUrl || '' %>"
                  data-name="<%= p.name %>"
                  data-price="<%= p.price %>"
                  data-color="<%= p.color %>"
                  data-description="<%= p.description || '' %>">
                <td>
                  <div class="product-image">
                    <img src="<%= p.imageUrl && p.imageUrl.length ? p.imageUrl : '/images/placeholder-80.png' %>" alt="<%= p.name %>">
                  </div>
                </td>
                <td class="product-name"><%= p.name %></td>
                <td class="product-price">$<%= p.price %></td>
                <td>
                  <span class="color-badge"><%= p.color %></span>
                </td>
                <td class="product-desc"><%= p.description || '-' %></td>
                <td class="text-center">
                  <div class="action-buttons">
                    <button class="btn-action btn-edit" title="Edit Product">
                      <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn-action btn-delete" title="Delete Product">
                      <i class="fas fa-trash-alt"></i>
                    </button>
                  </div>
                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>

      <!-- Mobile Card View -->
      <div class="mobile-products-view">
        <% products.forEach(function(p){ %>
          <div class="product-card" 
               data-id="<%= p.id %>" 
               data-image="<%= p.imageUrl || '' %>"
               data-name="<%= p.name %>"
               data-price="<%= p.price %>"
               data-color="<%= p.color %>"
               data-description="<%= p.description || '' %>">
            <div class="product-card-header">
              <div class="product-card-image">
                <img src="<%= p.imageUrl && p.imageUrl.length ? p.imageUrl : '/images/placeholder-80.png' %>" alt="<%= p.name %>">
              </div>
              <div class="product-card-info">
                <h3 class="product-card-name"><%= p.name %></h3>
                <div class="product-card-meta">
                  <div class="product-card-price">$<%= p.price %></div>
                  <span class="color-badge-mobile"><%= p.color %></span>
                </div>
                <!-- Toggle button cho mobile để hiện/ẩn description -->
                <button class="btn-toggle-desc" onclick="toggleDescription(this)">View Details</button>
              </div>
            </div>
            <div class="product-card-body">
              <% if (p.description) { %>
                <div class="product-card-row">
                  <span class="product-card-label"><i class="fas fa-align-left"></i> Description:</span>
                  <span class="product-card-desc"><%= p.description %></span>
                </div>
              <% } %>
            </div>
            <div class="product-card-actions">
              <button class="btn-card-action btn-edit-card" title="Edit Product">
                <i class="fas fa-edit"></i> Edit
              </button>
              <button class="btn-card-action btn-delete-card" title="Delete Product">
                <i class="fas fa-trash-alt"></i> Delete
              </button>
            </div>
          </div>
        <% }) %>
      </div>
      
      <!-- Pagination Section -->
      <div class="pagination-wrapper">
        <div class="pagination-info">
          Showing <strong><%= ((pagination.page - 1) * pagination.limit) + 1 %>-<%= Math.min(pagination.page * pagination.limit, pagination.total) %></strong> of <strong><%= pagination.total %></strong> products
        </div>
        <ul class="pagination">
          <li class="page-item <%= pagination.hasPrev ? '' : 'disabled' %>">
            <a class="page-link" href="?page=<%= pagination.page - 1 %>" tabindex="<%= pagination.hasPrev ? 0 : -1 %>">
              <i class="fas fa-chevron-left"></i>
            </a>
          </li>
          
          <% for(let i = 1; i <= pagination.totalPages; i++) { %>
            <% if(i === 1 || i === pagination.totalPages || (i >= pagination.page - 1 && i <= pagination.page + 1)) { %>
              <li class="page-item <%= i === pagination.page ? 'active' : '' %>">
                <a class="page-link" href="?page=<%= i %>"><%= i %></a>
              </li>
            <% } else if(i === pagination.page - 2 || i === pagination.page + 2) { %>
              <li class="page-item disabled">
                <span class="page-link">...</span>
              </li>
            <% } %>
          <% } %>
          
          <li class="page-item <%= pagination.hasNext ? '' : 'disabled' %>">
            <a class="page-link" href="?page=<%= pagination.page + 1 %>" tabindex="<%= pagination.hasNext ? 0 : -1 %>">
              <i class="fas fa-chevron-right"></i>
            </a>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Professional Modal Form -->
  <div class="modal fade" id="productModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content custom-modal">
        <form id="product-form">
          <div class="modal-header">
            <h5 class="modal-title" id="modalTitle">
              <i class="fas fa-plus-circle"></i>
              <span>Add Product</span>
            </h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          
          <div class="modal-body">
            <input type="hidden" id="product-id">
            
            <!-- Responsive Layout: 2 cột từ mobile lớn trở lên, 1 cột trên mobile nhỏ -->
            <div class="row g-4">
              <!-- Product Image - Left Column on Mobile Large+ -->
              <div class="col-12 col-sm-5 col-lg-4">
                <div class="form-group">
                  <label class="form-label">
                    <i class="fas fa-image"></i> Product Image
                  </label>
                  <div class="image-upload-area" onclick="document.getElementById('imageFile').click()">
                    <img id="img-preview" src="/images/placeholder-80.png" alt="Preview">
                    <div class="upload-overlay">
                      <i class="fas fa-camera"></i>
                      <span>Click to upload image</span>
                      <small>PNG, JPG up to 5MB</small>
                    </div>
                  </div>
                  <input id="imageFile" name="imageFile" type="file" 
                         accept="image/*" class="d-none">
                  <input type="hidden" id="imageUrl" name="imageUrl">
                </div>
              </div>

              <!-- Product Information - Right Column on Mobile Large+ -->
              <div class="col-12 col-sm-7 col-lg-8">
                <div class="row g-3">
                  <!-- Product Name -->
                  <div class="col-12">
                    <div class="form-group">
                      <label class="form-label">
                        <i class="fas fa-tag"></i> Product Name
                      </label>
                      <input id="name" name="name" type="text" class="form-control" 
                             required placeholder="Enter product name">
                    </div>
                  </div>
                  
                  <!-- Price -->
                  <div class="col-md-6">
                    <div class="form-group">
                      <label class="form-label">
                        <i class="fas fa-dollar-sign"></i> Price
                      </label>
                      <div class="input-group">
                        <span class="input-group-text">
                          <i class="fas fa-money-bill-wave"></i>
                        </span>
                        <input id="price" name="price" type="number" step="0.01" 
                               class="form-control" required placeholder="0.00">
                      </div>
                    </div>
                  </div>
                  
                  <!-- Color -->
                  <div class="col-md-6">
                    <div class="form-group">
                      <label class="form-label">
                        <i class="fas fa-palette"></i> Color
                      </label>
                      <div class="input-group">
                        <span class="input-group-text">
                          <i class="fas fa-paint-brush"></i>
                        </span>
                        <input id="color" name="color" type="text" 
                               class="form-control" required placeholder="e.g., Red">
                      </div>
                    </div>
                  </div>
                  
                  <!-- Description -->
                  <div class="col-12">
                    <div class="form-group">
                      <label class="form-label">
                        <i class="fas fa-align-left"></i> Description
                      </label>
                      <textarea id="description" name="description" class="form-control" 
                                rows="3" placeholder="Enter product description (optional)"></textarea>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="modal-footer">
            <button type="button" class="btn btn-cancel" data-bs-dismiss="modal">
              <i class="fas fa-times"></i> Cancel
            </button>
            <button type="submit" class="btn btn-save">
              <i class="fas fa-save"></i> Save Product
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div class="modal fade" id="deleteModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">
            <i class="fas fa-trash-alt"></i> Delete Product
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="text-center mb-3">
            <i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: #dc2626;"></i>
          </div>
          <p class="text-center mb-3">Are you sure you want to permanently delete this product?</p>
          <div class="alert alert-warning" role="alert">
            <strong id="delete-product-name"></strong>
          </div>
          <p class="text-center text-danger mb-0">
            <i class="fas fa-exclamation-circle"></i> <strong>This action cannot be undone!</strong>
          </p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-cancel" data-bs-dismiss="modal">
            <i class="fas fa-times"></i> Cancel
          </button>
          <button type="button" class="btn btn-danger" id="btn-confirm-delete">
            <i class="fas fa-trash-alt"></i> Delete Product
          </button>
        </div>
      </div>
    </div>
  </div>

<%- include('partials/footer') %>
