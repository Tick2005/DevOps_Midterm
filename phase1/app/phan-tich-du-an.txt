# PHÂN TÍCH TOÀN BỘ DỰ ÁN NODE.JS (sample-midterm-node.js-project)

## 1. Cấu trúc thư mục

- main.js: File khởi động chính của server.
- package.json: Thông tin dự án, dependencies, scripts.
- README.md: (chưa phân tích nội dung)
- controllers/
  - productController.js: Xử lý logic cho sản phẩm (CRUD).
- models/
  - product.js: Định nghĩa schema sản phẩm với mongoose.
- public/
  - css/styles.css: CSS giao diện.
  - images/: Ảnh tĩnh, placeholder.
  - js/ui.js: Xử lý UI phía client (thêm/sửa/xóa sản phẩm qua modal).
  - uploads/: Ảnh upload từ người dùng.
- routes/
  - productRoutes.js: Định nghĩa API cho sản phẩm (RESTful, upload ảnh).
  - uiRoutes.js: Route render trang index.ejs.
- services/
  - dataSource.js: Quản lý nguồn dữ liệu (MongoDB hoặc in-memory).
- validators/
  - productValidator.js: Validate dữ liệu sản phẩm với express-validator.
- views/
  - index.ejs: Giao diện chính (danh sách sản phẩm, modal CRUD).
  - partials/head.ejs, footer.ejs: Template phụ (header, footer).

## 2. Nội dung & Chức năng chính

### main.js
- Khởi tạo express, cấu hình view engine EJS, static folder.
- Đọc biến môi trường từ .env.
- Kết nối MongoDB (nếu thất bại sẽ dùng in-memory array).
- Đảm bảo thư mục uploads tồn tại.
- Mount routes: `/` (uiRoutes), `/products` (productRoutes).
- Lắng nghe PORT (mặc định 3000).

### package.json
- Scripts: `start` (node main.js), `dev` (nodemon), `test` (placeholder).
- Dependencies: express, mongoose, dotenv, ejs, express-validator, multer, uuid.
- DevDependencies: nodemon.

### controllers/productController.js
- Các hàm xử lý API sản phẩm:
  - list: Lấy tất cả sản phẩm.
  - getOne: Lấy 1 sản phẩm theo id.
  - create: Thêm sản phẩm mới (có thể upload ảnh).
  - put: Thay thế toàn bộ sản phẩm.
  - patch: Cập nhật 1 phần sản phẩm.
  - remove: Xóa sản phẩm.
- Tất cả thao tác qua dataSource (MongoDB hoặc in-memory).

### models/product.js
- Định nghĩa schema sản phẩm:
  - name (String, required)
  - price (Number, required)
  - color (String, required)
  - description (String, optional)
  - imageUrl (String, optional)
- Sử dụng mongoose để mapping với MongoDB.

### services/dataSource.js
- Quản lý nguồn dữ liệu:
  - Nếu dùng MongoDB: thao tác với ProductModel.
  - Nếu không: thao tác với mảng inMemory.
- Các hàm:
  - init: Khởi tạo dữ liệu mẫu (Apple products), seed MongoDB nếu trống.
  - getAll, getById, create, replace, patch, remove: CRUD cho sản phẩm.
  - Xử lý xóa file ảnh cũ khi update/xóa sản phẩm có ảnh upload.

### validators/productValidator.js
- Định nghĩa các rule validate cho create, put, patch sản phẩm.
- Sử dụng express-validator để kiểm tra dữ liệu gửi lên.

### routes/productRoutes.js
- Định nghĩa các route RESTful cho sản phẩm:
  - GET /products: Lấy danh sách.
  - GET /products/:id: Lấy 1 sản phẩm.
  - POST /products: Thêm mới (có upload ảnh).
  - PUT/PATCH /products/:id: Sửa (có upload ảnh).
  - DELETE /products/:id: Xóa.
- Sử dụng multer để upload file ảnh vào /public/uploads.
- Validate dữ liệu trước khi gọi controller.

### routes/uiRoutes.js
- GET /: Render trang index.ejs với danh sách sản phẩm.

### public/js/ui.js
- Xử lý UI phía client:
  - Mở modal thêm/sửa sản phẩm.
  - Preview ảnh khi chọn file.
  - Gửi form thêm/sửa qua fetch (POST/PATCH).
  - Xóa sản phẩm qua fetch (DELETE).
  - Reload trang khi thao tác thành công.

### views/index.ejs
- Hiển thị bảng sản phẩm, nút thêm, modal CRUD.
- Sử dụng Bootstrap 5.
- Hiển thị ảnh, tên, giá, màu, mô tả, action (edit/delete).

### views/partials/head.ejs, footer.ejs
- head.ejs: Khai báo meta, link Bootstrap, CSS.
- footer.ejs: Đóng thẻ, nhúng js/ui.js, Bootstrap JS.

### public/css/styles.css
- CSS đơn giản cho body, table, modal.

## 3. Cách build & chạy

1. Cài Node.js >= 16, MongoDB (nếu muốn dùng database thật).
2. Chạy `npm install` để cài dependencies.
3. Tạo file .env (nếu cần), ví dụ:
   - MONGO_URI=mongodb://localhost:27017/products_db
   - PORT=3000
4. Chạy `npm start` hoặc `npm run dev` (nếu muốn hot reload).
5. Truy cập http://localhost:3000 để sử dụng.

## 4. Các cơ sở & function quan trọng

- Sử dụng Express.js làm web server.
- Sử dụng EJS làm view engine.
- Sử dụng Mongoose để kết nối MongoDB (nếu có), fallback sang in-memory nếu không kết nối được.
- Sử dụng Multer để upload file ảnh.
- Sử dụng express-validator để validate dữ liệu.
- CRUD sản phẩm: controllers/productController.js, services/dataSource.js.
- UI động với fetch API và Bootstrap modal (public/js/ui.js).

## 5. Tổng kết

Dự án này là một web app quản lý sản phẩm (Apple) với khả năng thêm/sửa/xóa, upload ảnh, validate dữ liệu, hỗ trợ cả MongoDB và in-memory, giao diện đẹp với Bootstrap, code rõ ràng, dễ mở rộng.
